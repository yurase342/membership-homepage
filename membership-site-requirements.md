# メンバーシップサイト 要件定義書

## 1. プロジェクト概要

### 1.1 目的
3階層のメンバーシッププランに基づき、パスワード認証によるアクセス制限機能を持つホームページを構築する。

### 1.2 開発環境
- 開発ツール: Cursor
- 想定技術スタック: HTML/CSS/JavaScript（静的サイト）または Next.js/React等（要検討）

---

## 2. 会員プラン構成

| ランク | プラン名 | 閲覧可能範囲 |
|--------|----------|--------------|
| 最上位 | エゴイスト | 全ページ（エゴイスト限定含む） |
| 中間 | ベテラン探検隊 | 一般ページ + ベテラン探検隊以上限定ページ |
| 最下位 | 探検隊 | 一般ページのみ |

---

## 3. ページ構成とアクセス権限

### 3.1 ページ種別

```
メインホームページ（全員閲覧可）
├── 一般コンテンツエリア
├── [リンク] ベテラン探検隊以上限定ページへ → パスワードA要求
└── [リンク] エゴイスト限定ページへ → パスワードB要求
```

### 3.2 アクセス権限マトリクス

| ページ種別 | 探検隊 | ベテラン探検隊 | エゴイスト |
|------------|--------|----------------|------------|
| メインホームページ | ✅ | ✅ | ✅ |
| ベテラン探検隊以上限定 | ❌ | ✅（パスワードA） | ✅（パスワードA） |
| エゴイスト限定 | ❌ | ❌ | ✅（パスワードB） |

---

## 4. パスワード認証システム

### 4.1 基本仕様

| 項目 | 仕様 |
|------|------|
| パスワード数 | 2種類（ベテラン用・エゴイスト用） |
| 認証方式 | ページアクセス時にパスワード入力画面を表示 |
| 変更頻度 | 最大月1回の変更を想定 |
| 認証後の動作 | 該当限定ページへ遷移 |

### 4.2 パスワード管理要件

1. **変更容易性**: 管理者が簡単にパスワードを変更できること
2. **一元管理**: パスワードは1箇所で管理し、変更時の作業を最小化
3. **セキュリティ**: パスワードはソースコード上で平文表示しない（推奨）

### 4.3 認証フロー

```
[ユーザーがリンクをクリック]
        ↓
[パスワード入力モーダル/ページ表示]
        ↓
    [入力]
        ↓
[パスワード照合] ── 不一致 → [エラーメッセージ表示] → [再入力]
        ↓
      一致
        ↓
[限定ページへ遷移]
```

---

## 5. 機能要件

### 5.1 必須機能（Must Have）

| ID | 機能名 | 説明 |
|----|--------|------|
| F-001 | メインページ表示 | 全会員が閲覧可能なトップページ |
| F-002 | 限定ページリンク表示 | メインページ内に2種類の限定ページへのリンクを設置 |
| F-003 | パスワード認証（ベテラン） | ベテラン探検隊以上限定ページへのアクセス時に認証 |
| F-004 | パスワード認証（エゴイスト） | エゴイスト限定ページへのアクセス時に認証 |
| F-005 | 認証エラー表示 | パスワード不一致時のエラーメッセージ |
| F-006 | パスワード変更機能 | 管理者がパスワードを容易に変更可能 |

### 5.2 推奨機能（Should Have）

| ID | 機能名 | 説明 |
|----|--------|------|
| F-007 | セッション維持 | 認証後、一定時間は再認証不要（ブラウザセッション中） |
| F-008 | パスワード入力時のマスク | 入力文字を●で表示 |
| F-009 | 認証失敗回数制限 | 連続失敗時の一時ロック（オプション） |

### 5.3 将来拡張機能（Nice to Have）

| ID | 機能名 | 説明 |
|----|--------|------|
| F-010 | パスワード有効期限通知 | 管理者への変更時期リマインド |
| F-011 | アクセスログ | 限定ページへのアクセス記録 |

---

## 6. 非機能要件

### 6.1 ユーザビリティ
- パスワード入力UIは直感的で分かりやすいこと
- エラー時は何が間違っているか明確に伝えること
- モバイル対応（レスポンシブデザイン）

### 6.2 保守性
- パスワード変更は設定ファイル1箇所の編集で完了すること
- コードは可読性を重視し、コメントを適切に記載

### 6.3 セキュリティ考慮事項
- パスワードの平文保存を避ける（ハッシュ化推奨）
- 直接URLアクセスでも認証をバイパスできないこと

---

## 7. 技術設計

### 7.1 採用する実装方式

```
【採用】フロントエンドのみ（静的サイト） + 運用によるURL制限

理由:
- 既存ひな形との親和性が高い
- Vercelで簡単にデプロイ可能
- URLを会員限定共有するため、厳密なサーバー認証は不要
- パスワード変更も設定ファイル1箇所で完結
```

### 7.2 推奨ファイル構成（Vercel静的サイト）

```
project/
├── index.html                    # メインホームページ（全員閲覧可）
│
├── veteran/                      # ベテラン探検隊以上限定エリア
│   ├── index.html               # 限定トップページ
│   ├── page1.html               # 限定コンテンツ1
│   ├── page2.html               # 限定コンテンツ2
│   └── (page3.html)             # 必要に応じて追加
│
├── egoist/                       # エゴイスト限定エリア
│   ├── index.html               # 限定トップページ
│   ├── page1.html               # 限定コンテンツ1
│   ├── page2.html               # 限定コンテンツ2
│   └── (page3.html)             # 必要に応じて追加
│
├── css/
│   └── style.css                # 共通スタイル
│
├── js/
│   ├── auth.js                  # 認証ロジック
│   └── config.js                # パスワード設定（月1回更新）
│
├── assets/
│   └── images/
│
└── vercel.json                  # Vercel設定（必要に応じて）
```

### 7.3 限定エリア内のナビゲーション

```
【ベテラン探検隊以上限定エリア】
  veteran/index.html（認証後の入口）
      ├── veteran/page1.html
      ├── veteran/page2.html
      └── メインページへ戻るリンク

【エゴイスト限定エリア】
  egoist/index.html（認証後の入口）
      ├── egoist/page1.html
      ├── egoist/page2.html
      └── メインページへ戻るリンク

※ 一度認証したら、同エリア内は自由に移動可能（セッション維持）
```

### 7.4 パスワード管理方法

```javascript
// js/config.js - 月1回このファイルのみ編集してパスワード変更
// ※ GitHubにプッシュ → Vercelが自動デプロイ で反映完了

const AUTH_CONFIG = {
  veteran: {
    password: "ベテラン用パスワード",  // ここを変更
    lastUpdated: "2025-01-17"
  },
  egoist: {
    password: "エゴイスト用パスワード",  // ここを変更
    lastUpdated: "2025-01-17"
  }
};
```

### 7.5 パスワード変更手順（月1回の運用）

```
1. js/config.js を開く
2. password の値を新しいパスワードに変更
3. lastUpdated を更新日に変更
4. GitHubにプッシュ
5. Vercelが自動デプロイ → 即座に反映
6. 会員に新パスワードを通知
```

### 7.6 認証の仕組み（実装イメージ）

```javascript
// js/auth.js - 認証ロジック

// 認証状態をセッションストレージで管理
function checkAuth(level) {
  return sessionStorage.getItem(`auth_${level}`) === 'true';
}

function authenticate(level, inputPassword) {
  const config = AUTH_CONFIG[level];
  if (inputPassword === config.password) {
    sessionStorage.setItem(`auth_${level}`, 'true');
    return true;
  }
  return false;
}

// 限定ページ読み込み時に認証チェック
function requireAuth(level) {
  if (!checkAuth(level)) {
    // 未認証 → パスワード入力モーダル表示 or 認証ページへリダイレクト
    showAuthModal(level);
  }
}
```

---

## 8. 画面遷移図

```
┌─────────────────────────────────────────────────────────┐
│                  メインホームページ                      │
│                   （全員閲覧可）                         │
│                                                         │
│  ┌─────────────────┐    ┌─────────────────┐            │
│  │ ベテラン探検隊   │    │   エゴイスト    │            │
│  │ 以上限定ページへ │    │ 限定ページへ    │            │
│  └────────┬────────┘    └────────┬────────┘            │
└───────────┼──────────────────────┼──────────────────────┘
            │                      │
            ▼                      ▼
   ┌─────────────────┐    ┌─────────────────┐
   │パスワード入力    │    │パスワード入力    │
   │（ベテラン用）    │    │（エゴイスト用）  │
   └────────┬────────┘    └────────┬────────┘
            │                      │
      認証成功                認証成功
            │                      │
            ▼                      ▼
   ┌─────────────────┐    ┌─────────────────┐
   │ベテラン限定      │    │エゴイスト限定   │
   │トップページ      │    │トップページ     │
   │  (veteran/)      │    │  (egoist/)      │
   ├─────────────────┤    ├─────────────────┤
   │ ├─ page1.html   │    │ ├─ page1.html   │
   │ ├─ page2.html   │    │ ├─ page2.html   │
   │ └─ (page3.html) │    │ └─ (page3.html) │
   └─────────────────┘    └─────────────────┘
   
   ※ 認証後は各エリア内を自由に移動可能
   ※ ブラウザを閉じると認証状態リセット
```

---

## 9. 決定事項

### 9.1 確定した仕様

| # | 項目 | 決定内容 |
|---|------|----------|
| 1 | ホスティング先 | **GitHub → Vercel** でデプロイ |
| 2 | 実装方式 | **フロントエンドのみ（静的サイト）** |
| 3 | セキュリティ方針 | URLを会員にのみ共有 + パスワード認証（2重保護） |
| 4 | 限定ページ構成 | 各カテゴリ **2〜3ページ** の複数ページ構成 |
| 5 | 既存資産 | **ひな形ホームページ作成中** → 既存デザインに組み込み |

### 9.2 セキュリティ考え方

```
【運用によるセキュリティ】
  メンバーシップ会員にのみURLを共有
        ↓
【技術によるセキュリティ】
  限定ページへのパスワード認証
        ↓
【結果】
  2重の保護により、静的サイトでも十分な保護を実現
```

> ※ URLを会員限定で共有する運用のため、万が一パスワードが漏洩しても、
> そもそもサイトURLを知らない人はアクセスできない設計

---

## 10. Cursor開発ガイド

### 10.1 Cursorへの指示例（プロンプト）

**認証機能の実装依頼:**
```
既存のindex.htmlに、以下の機能を追加してください：
1. 「ベテラン探検隊以上限定」ボタンをクリックするとパスワード入力モーダルが表示される
2. 「エゴイスト限定」ボタンをクリックすると別のパスワード入力モーダルが表示される
3. パスワードはjs/config.jsで一元管理する
4. 認証成功したらsessionStorageに保存し、該当の限定ページへ遷移する
5. 限定ページでは、認証済みかチェックして未認証ならモーダルを表示する
```

**限定ページの認証チェック追加:**
```
veteran/index.html に認証チェック機能を追加してください：
- ページ読み込み時にsessionStorageの認証状態を確認
- 未認証の場合はパスワード入力モーダルを表示
- 認証済みの場合はそのまま表示
- veteran/内の他ページへのリンクも設置
```

### 10.2 既存ひな形への組み込み手順

```
Step 1: js/config.js と js/auth.js を作成
Step 2: index.html に限定ページへのリンクボタンを追加
Step 3: パスワード入力モーダルのHTML/CSSを追加
Step 4: veteran/ と egoist/ フォルダを作成し、限定ページを配置
Step 5: 各限定ページに認証チェックスクリプトを追加
Step 6: 動作テスト
Step 7: GitHubプッシュ → Vercelデプロイ
```

---

## 11. 開発スケジュール目安

| フェーズ | 内容 | 想定期間 |
|----------|------|----------|
| Phase 1 | 基本構造・メインページ作成 | 1-2日 |
| Phase 2 | パスワード認証機能実装 | 1-2日 |
| Phase 3 | 限定ページ作成 | 1日 |
| Phase 4 | テスト・調整 | 1日 |
| Phase 5 | デプロイ・公開 | 0.5日 |

---

## 改訂履歴

| バージョン | 日付 | 内容 |
|------------|------|------|
| 1.0 | 2025-01-17 | 初版作成 |
| 1.1 | 2025-01-17 | 決定事項反映（Vercel、静的サイト、複数ページ構成）、Cursor開発ガイド追加 |
